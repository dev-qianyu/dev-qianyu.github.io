<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>お問い合わせフォーム（例）</title>
  <style>
    /* シンプルで見やすいスタイル（レスポンシブ） */
    :root {
      --max-width: 720px;
      --gap: 12px;
      --accent: #0b76ef;
      --radius: 8px;
    }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f6f8fb;
      color: #111;
      padding: 24px;
      display: flex;
      justify-content: center;
    }
    .card {
      width: 100%;
      max-width: var(--max-width);
      background: #fff;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: 0 6px 18px rgba(10,10,20,0.06);
    }
    h1 { margin: 0 0 8px 0; font-size: 1.25rem; }
    p.lead { margin: 0 0 18px 0; color: #556; font-size: .95rem; }

    form {
      display: grid;
      gap: var(--gap);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
    }

    label {
      display: block;
      font-size: .9rem;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d6dae3;
      border-radius: 6px;
      font-size: .95rem;
      box-sizing: border-box;
    }

    textarea { min-height: 120px; resize: vertical; }

    .small {
      font-size: .82rem;
      color: #666;
      margin-top: 6px;
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    button[type="submit"] {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }

    .error {
      color: #d12b2b;
      font-size: .88rem;
    }

    .status {
      font-size: .95rem;
    }

    /* フォーカスやエラーの見た目 */
    input:focus, textarea:focus, select:focus {
      outline: 3px solid rgba(11,118,239,0.12);
      border-color: var(--accent);
    }
    input[aria-invalid="true"], textarea[aria-invalid="true"], select[aria-invalid="true"] {
      border-color: #d12b2b;
      box-shadow: 0 0 0 3px rgba(209,43,43,0.06);
    }

    /* モバイル対応 */
    @media (max-width: 640px) {
      .row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="card" aria-labelledby="formTitle">
    <h1 id="formTitle">お問い合わせ</h1>
    <p class="lead">ご質問・ご要望は下のフォームから送信してください。必須項目はマークされています。</p>

    <form id="contactForm" action="/api/contact" method="post" enctype="multipart/form-data" novalidate>
      <!-- 名前 -->
      <div>
        <label for="name">お名前 <span aria-hidden="true">＊</span></label>
        <input id="name" name="name" type="text" required aria-required="true" minlength="2" maxlength="80" />
        <div id="err-name" class="error" aria-live="polite"></div>
      </div>

      <div class="row">
        <!-- メール -->
        <div>
          <label for="email">メールアドレス <span aria-hidden="true">＊</span></label>
          <input id="email" name="email" type="email" required aria-required="true" maxlength="254" />
          <div id="err-email" class="error" aria-live="polite"></div>
        </div>

        <!-- 電話 -->
        <div>
          <label for="tel">電話番号（任意）</label>
          <input id="tel" name="tel" type="tel" pattern="^\+?\d{7,15}$" placeholder="+819012345678" />
          <div class="small">国際形式（例: +8190xxxx）で入力してください。</div>
          <div id="err-tel" class="error" aria-live="polite"></div>
        </div>
      </div>

      <!-- 種類 -->
      <div>
        <label for="category">お問い合わせの種類</label>
        <select id="category" name="category" required>
          <option value="">選択してください</option>
          <option value="support">サポート</option>
          <option value="sales">営業</option>
          <option value="feedback">ご意見・ご要望</option>
          <option value="other">その他</option>
        </select>
        <div id="err-category" class="error" aria-live="polite"></div>
      </div>

      <!-- メッセージ -->
      <div>
        <label for="message">メッセージ <span aria-hidden="true">＊</span></label>
        <textarea id="message" name="message" required minlength="10" maxlength="3000" aria-required="true"
          placeholder="お問い合わせの内容を詳しくご記入ください。"></textarea>
        <div id="err-message" class="error" aria-live="polite"></div>
      </div>

      <!-- ファイル（任意） -->
      <div>
        <label for="attachment">添付ファイル（任意、最大5MB）</label>
        <input id="attachment" name="attachment" type="file" accept=".png,.jpg,.jpeg,.pdf,.txt" />
        <div id="err-attachment" class="error" aria-live="polite"></div>
      </div>

      <!-- 同意 -->
      <div>
        <label>
          <input id="consent" name="consent" type="checkbox" required aria-required="true" />
          個人情報の取り扱いに同意します。<span class="small">(必須)</span>
        </label>
        <div id="err-consent" class="error" aria-live="polite"></div>
      </div>

      <!-- アクション -->
      <div class="actions">
        <button id="submitBtn" type="submit">送信</button>
        <div id="status" class="status" aria-live="polite"></div>
      </div>
    </form>
  </main>

  <script>
    // クライアント側の基本バリデーション + ファイルサイズチェック + fetch送信の例
    (function () {
      const form = document.getElementById('contactForm');
      const submitBtn = document.getElementById('submitBtn');
      const status = document.getElementById('status');
      const maxFileSize = 5 * 1024 * 1024; // 5MB

      // ヘルパー：エラー表示
      function setError(id, message) {
        const el = document.getElementById('err-' + id);
        const field = document.getElementById(id);
        if (el) el.textContent = message || '';
        if (field) field.setAttribute('aria-invalid', !!message);
      }

      // フォーム送信時
      form.addEventListener('submit', async (ev) => {
        ev.preventDefault();
        // クリア
        ['name','email','tel','category','message','attachment','consent'].forEach(i => setError(i, '') );
        status.textContent = '';

        // HTML標準検証
        if (!form.checkValidity()) {
          // 標準検証の結果を読み取り、カスタムメッセージを出す
          if (!form.name.checkValidity()) setError('name', '名前を正しく入力してください（2文字以上）');
          if (!form.email.checkValidity()) setError('email', '有効なメールアドレスを入力してください');
          if (!form.category.checkValidity()) setError('category', 'お問い合わせの種類を選んでください');
          if (!form.message.checkValidity()) setError('message', 'メッセージを入力してください（10文字以上）');
          if (!form.consent.checkValidity()) setError('consent', '同意が必要です');
          return;
        }

        // ファイルサイズチェック
        const fileInput = form.attachment;
        if (fileInput.files && fileInput.files.length > 0) {
          const f = fileInput.files[0];
          if (f.size > maxFileSize) {
            setError('attachment', 'ファイルサイズは最大5MBまでです');
            return;
          }
        }

        // 送信ボタン無効化
        submitBtn.disabled = true;
        submitBtn.textContent = '送信中…';

        try {
          // フォームデータをそのまま送る（multipart/form-data）
          const fd = new FormData(form);

          // ここでは例として /api/contact に POST で送信
          const res = await fetch(form.action, {
            method: 'POST',
            body: fd,
            credentials: 'same-origin'
          });

          if (!res.ok) {
            // エラーハンドリング（サーバーが400/422でフィールドエラー返す想定）
            let data;
            try { data = await res.json(); } catch(e) { data = null; }
            if (data && data.errors) {
              // { field: "message" } の形を想定
              Object.entries(data.errors).forEach(([k,v]) => {
                setError(k, v);
              });
            } else {
              status.textContent = '送信に失敗しました。時間を置いて再度お試しください。';
            }
            throw new Error('network');
          }

          // 成功
          status.textContent = '送信が完了しました。ありがとうございました。';
          form.reset();
        } catch (err) {
          console.error(err);
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = '送信';
        }
      });

      // 入力時にエラーを消す簡易処理
      ['name','email','tel','category','message','attachment','consent'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('input', () => setError(id, ''));
      });

    })();
  </script>
</body>
</html>
